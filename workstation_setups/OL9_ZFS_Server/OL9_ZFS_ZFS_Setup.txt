sudo dnf install -y kernel-devel-$(uname -r) kernel-headers-$(uname -r)

ğŸ“¦ Step 1 â€” Add the OpenZFS Repository

Download and install the OpenZFS repo RPM:

sudo dnf install -y https://zfsonlinux.org/epel/zfs-release-2-4.el9.noarch.rpm


This adds a zfs.repo file to /etc/yum.repos.d/ with the OpenZFS repo and its GPG key.


ğŸ§© Step 2 â€” Choose Packaging Style
Install DKMS ZFS packages:

sudo dnf config-manager --enable zfs
sudo dnf install -y zfs zfs-dkms


During installation DKMS will build the ZFS kernel modules.



ğŸ”Œ Step 3 â€” Load the ZFS Kernel Module

Once installed:

sudo modprobe zfs


Check that it loaded:

lsmod | grep zfs


If you see nothing or get an error like Module zfs not found, it usually means:

The kernel module didnâ€™t build (with DKMS) or

There isnâ€™t a matching kmod package for your exact kernel.

In that case, try reinstalling or switch to DKMS.

ğŸ“Œ Optional â€” Enable Services at Boot

To ensure ZFS services (import/mount) run on boot:

sudo systemctl enable zfs-import-cache zfs-mount zfs.target


ğŸ§ª Verifying Your Installation

Check ZFS utilities and version:

zfs --version
zpool --version



update to 2.4.0
ğŸ§¹ Step 1: Remove the old DKMS version (but NOT your pools)

This does not touch your zpools.

$   sudo dkms remove zfs/2.2.9 --all


Example:

$   sudo dkms remove zfs/2.1.13 --all


Then remove the old source tree:

$   sudo rm -rf /usr/src/zfs-*


(Optional but recommended)

$   sudo modprobe -r zfs

sudo dnf config-manager --enable zfs-testing
sudo dnf install zfs zfs-dkms zfs-test
sudo modprobe zfs

If everything goes well, youâ€™ll see:

zfs/2.4.0, <kernel>, installed

ğŸš€ Step 5: Load ZFS and verify
sudo modprobe zfs
zfs version

3ï¸âƒ£ Make sure it autoloads on future boots

DKMS usually sets this up automatically, but on Oracle Linux:

sudo systemctl enable zfs-import-cache
sudo systemctl enable zfs-mount
sudo systemctl enable zfs-import.target


You should now see 2.4.0 for both kernel module and userland.

Your pools should import automatically. If not:

sudo zpool import

version lock

sudo dnf install -y 'dnf-command(versionlock)'

your installed ZFS packages
rpm -q zfs zfs-dkms zfs-test


Example output:

zfs-2.4.0-1.el9.x86_64
zfs-dkms-2.4.0-1.el9.noarch
zfs-test-2.4.0-1.el9.x86_64


3ï¸âƒ£ Lock the packages to the current version
$ sudo dnf versionlock add zfs-2.4.0 zfs-dkms-2.4.0 zfs-test-2.4.0
This prevents DNF from upgrading ZFS packages, even if a newer version appears in any enabled repo (like zfs-testing).

[user_root@localhost ~]$ uname -r
rpm -q kernel kernel-devel
5.14.0-503.11.1.el9_5.x86_64
kernel-devel-5.14.0-503.11.1.el9_5.x86_64

sudo dnf versionlock add kernel-5.14.0-503.11.1.el9_5.x86_64 kernel-devel-5.14.0-503.11.1.el9_5.x86_64

lastly, remove testing repo
sudo dnf config-manager --set-disabled zfs-testing
